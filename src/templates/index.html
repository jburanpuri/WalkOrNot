<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walk or Not</title>
</head>

<body>
    <h1>Walk or Not</h1>

    <form id="weather-form" method="POST">
        <label for="city">Enter city name:</label>
        <input type="text" id="city" name="city" placeholder="Enter city name">
        <button type="submit">Submit</button>
    </form>

    <div id="previous-requests">
        <h2>Previous Requests</h2>
        <ul id="requests-list">
            {% for request in previous_requests %}
            <li>{{ request.city }} - {{ request.temperature }}°C ({{ request.time }})</li>
            {% endfor %}
        </ul>
    </div>

    <script>
        document.getElementById('weather-form').addEventListener('submit', function (event) {
            event.preventDefault();
            var city = document.getElementById('city').value;
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                var response = JSON.parse(xhr.responseText);
                if (response.message) {
                    alert(response.message); // or display the message in a designated area
                } else if (response.error_message) {
                    alert(response.error_message); // or display the error message in a designated area
                }
            };
            xhr.send('city=' + encodeURIComponent(city));
        });

        function updatePreviousRequests() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/');
            xhr.onload = function () {
                var response = JSON.parse(xhr.responseText);
                var previousRequests = response.previous_requests;
                var requestsList = document.getElementById('requests-list');
                requestsList.innerHTML = ''; // clear the previous list
                previousRequests.forEach(function (request) {
                    var li = document.createElement('li');
                    li.textContent = request.city + ' - ' + request.temperature + '°C (' + request.time + ')';
                    requestsList.appendChild(li);
                });
            };
            xhr.send();
        }
        // call updatePreviousRequests initially and every 5 seconds
        updatePreviousRequests();
        setInterval(updatePreviousRequests, 50);
    </script>
</body>

</html>